---
title: 018-JS äº‹ä»¶
date: 2023-03-17 15:42
updated: 2023-03-17 15:42
cover: //cdn.wallleap.cn/img/post/1.jpg
image-auto-upload: true
author: Luwang
comments: true
aliases:
  - 018-JS äº‹ä»¶
rating: 1
tags:
  - JavaScript
category: web
keywords:
  - å…³é”®è¯1
  - å…³é”®è¯2
  - å…³é”®è¯3
description: æ–‡ç« æè¿°
source: #
url: //myblog.wallleap.cn/post/1
---

## äº‹ä»¶

äº‹ä»¶æ˜¯ç³»ç»Ÿå†…å‘ç”Ÿçš„åŠ¨ä½œæˆ–äº‹æƒ…
- ç”¨æˆ·è§¦å‘ï¼šé¼ æ ‡ç‚¹å‡»ã€æ»šåŠ¨ã€æ‹–æ‹½ã€é”®ç›˜æŒ‰ä¸‹ç­‰
- ç³»ç»Ÿç”Ÿæˆï¼šæ–‡æ¡£æˆ–å›¾ç‰‡åŠ è½½å®Œæˆã€åŠ¨ç”»ç»“æŸã€è§†é¢‘æ’­æ”¾æš‚åœ
- JS è§¦å‘ï¼šæ¯”å¦‚è°ƒç”¨ `HTMLElement.click()`
- åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶è§¦å‘ï¼ˆ`EventTarget.dispatchEvent()`ï¼‰

ä½¿ç”¨äº‹ä»¶ï¼š
1. è®¾ç½®äº‹ä»¶ç›‘å¬å‡½æ•°
2. äº‹ä»¶è§¦å‘è¢«ç›‘å¬å‡½æ•°å“åº”

ğŸŒ° ä¾‹å¦‚ï¼šç‚¹å‡»ä¿®æ”¹èƒŒæ™¯è‰²

## äº‹ä»¶ç»‘å®š

ä¸‰ç§æ–¹å¼

ç¬¬ä¸€ç§ `onxxx`

```js
node.onclick = function() {
  // do something
}
```

ç¬¬äºŒç§ äº‹ä»¶ç›‘å¬ `addEventListener`

```js
node.addEventListener('click', function() {
  // do something
})
```

âš ï¸ åºŸå¼ƒï¼Œç›´æ¥åœ¨æ ‡ç­¾ä¸ŠåŠ å±æ€§æ–¹æ³•

```html
<button onclick="doSomething">ç‚¹æˆ‘</button>  <!-- ä¹Ÿå¯ä»¥åŠ æ‹¬å· doSomething() -->
<script>
  function doSomething() {
    // do something
  }
</script>
```

å‰ä¸¤ç§çš„åŒºåˆ«
- `onclick` ç»‘å®šæ˜¯èµ‹å€¼ï¼Œå¤šæ¬¡ç›¸åŒèµ‹å€¼ä¼šè¦†ç›–ï¼Œåªæœ‰æœ€åä¸€æ¬¡ç”Ÿæ•ˆ
- `addEventListener` æ˜¯å‡½æ•°æ‰§è¡Œï¼Œå¯æ‰§è¡Œ/ç»‘å®šå¤šæ¬¡ï¼Œä¸”åŠŸèƒ½æ›´å¼ºå¤§

## this ä¸äº‹ä»¶å¯¹è±¡

äº‹ä»¶å¯¹è±¡åŒ…å«
- äº‹ä»¶çš„æ¥æº `e.target`
- äº‹ä»¶çš„ä½ç½®
- æŒ‰äº†å“ªä¸ªé”®...

äº‹ä»¶ç»‘å®šæ—¶
- æ™®é€šå‡½æ•°é‡Œçš„ `this` ä»£è¡¨ `.` å‰é¢çš„å¯¹è±¡
- ç®­å¤´å‡½æ•°é‡Œé¢çš„ `this` ä»£è¡¨å¤–é¢çš„ `this`

## äº‹ä»¶æµ

äº‹ä»¶ä¼ æ’­æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š
1. äº‹ä»¶æ•è·é˜¶æ®µ
2. ç›®æ ‡é˜¶æ®µ
3. äº‹ä»¶å†’æ³¡é˜¶æ®µ

çœ‹ä¸‹åªç‚¹å‡» button å…¶ä»–çš„ä¼šè§¦å‘å—

`Event.eventphase` æŸ¥çœ‹æ˜¯äº‹ä»¶ä¼ æ’­çš„å“ªä¸ªé˜¶æ®µ

ğŸ’¬ å°å¸¸è¯†ï¼šå¯¹è±¡åœ¨æ§åˆ¶å°ä¸­æ‰“å°ï¼Œç‚¹å‡»å¼€çš„æ—¶å€™å·²ç»æ‰§è¡Œå®Œäº†ï¼ŒæŸäº›åœºæ™¯éœ€è¦è½¬æˆ json æ‰“å°æˆ–åªæ‰“å°æŸä¸ªçŠ¶æ€å±æ€§

## addEventListener è¯¦ç»†ç”¨æ³•

`target.addEventListener(type,listener, userCapture)`
- typeï¼šäº‹ä»¶ç±»å‹
- listenerï¼šäº‹ä»¶å¤„ç†æ–¹å¼
- userCaptureï¼šå¯é€‰ï¼Œé»˜è®¤æ˜¯ falseï¼Œè¡¨ç¤ºå†’æ³¡é˜¶æ®µå¤„ç†ï¼›true è¡¨ç¤ºåœ¨æ•è·é˜¶æ®µè°ƒç”¨ listener

`target.addEventListener(type, listener, options)`
- optionsï¼šå¯é€‰ï¼Œæ˜¯ä¸ªå¯¹è±¡ `{ capture: true, once: true, passive: true }`
	- captureï¼šæ˜¯å¦æ•è·é˜¶æ®µç›‘å¬
	- onceï¼šæ˜¯å¦åªç›‘å¬ä¸€æ¬¡
	- passiveï¼šæ˜¯å¦å¿½ç•¥ preventDefaultï¼Œæå‡ç§»åŠ¨ç«¯æ€§èƒ½

`target.removeEventListener(type, handler)` è§£ç»‘äº‹ä»¶
- typeï¼šäº‹ä»¶ç±»å‹
- handlerï¼šå‡½æ•°åœ¨å¤–é¢å£°æ˜ï¼Œç„¶ååœ¨ç»‘å®šçš„æ—¶å€™ä½¿ç”¨å‡½æ•°ï¼Œåœ¨è¿™é‡Œè§£ç»‘

## this ä¸ event.target

`this` æ˜¯ `.addEventListener` å‰é¢çš„å¯¹è±¡

`e.target` ä»£è¡¨ç‚¹å‡»çš„å¯¹è±¡

## é˜»æ­¢ä¼ æ’­

`e.stopPropagation()`

åœæ­¢äº‹ä»¶ä¼ æ’­

ğŸŒ° ä¾‹å¦‚ï¼šæ¨¡æ€æ¡†
- ç‚¹å‡»æŒ‰é’®å‡ºç°æ¡†ï¼ˆæŒ‰é’®ç‚¹å‡» é˜»æ­¢ä¼ æ’­ï¼‰
- ç‚¹å‡»æ¡†å¤–é¢çš„æ¶ˆå¤±ï¼ˆdocument ç‚¹å‡»ï¼‰
- ç‚¹å‡»æ¡†æ˜¯è‡ªå·±çš„ï¼ˆé˜»æ­¢ä¼ æ’­ï¼‰

http://js.jirengu.com/noceguwopi

## å–æ¶ˆé»˜è®¤

`e.preventDefault()`

é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸º

æœ‰å“ªäº›é»˜è®¤è¡Œä¸º
- a é“¾æ¥ç‚¹å‡»è·³è½¬
- è¡¨å•ç‚¹å‡»ä¼šæäº¤ç­‰

ğŸŒ° ç‚¹å‡»é“¾æ¥ä¹‹ååˆ¤æ–­æ˜¯å¦æ˜¯ç«™å†…é“¾æ¥ï¼Œä¸æ˜¯åˆ™å¼¹çª—è¯¢é—®

```js
<a href="https://myblog.wallleap.cn/" target='_blank'>å®‰å…¨ wallleap</a>
<a href="https://baidu.com">å±é™© ç™¾åº¦</a>
<script>
document.querySelectorAll('a').forEach($link => {
  $link.onclick = function(e) {
	let href = this.getAttribute('href')
	if(!href.includes('wallleap.cn')) {
	  e.preventDefault()
	  if(confirm('è¿™ä¸ªä¸æ˜¯å†…éƒ¨ç½‘ç«™ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯å…¶å®‰å…¨æ€§ï¼Œä½ ä»è¦å‰å¾€å—')) {
		location.href = href
	  }
	}
  }
})
</script>
```


## äº‹ä»¶ä»£ç†/å§”æ‰˜

- äº‹ä»¶ç»‘å®šä»£ç†ç»™çˆ¶å…ƒç´ ï¼Œç”±çˆ¶å…ƒç´ æ ¹æ®äº‹ä»¶æ¥æºç»Ÿä¸€å¤„ç†
- é€‚ç”¨äºå¯èƒ½ä¼š**æ–°å¢å­å…ƒç´ **çš„åœºæ™¯
- äº‹ä»¶ä»£ç†å®é™…ä¸Šæ˜¯äº‹ä»¶å†’æ³¡çš„åº”ç”¨

ğŸŒ° å®ç°ä¸€ä¸ªç®€æ˜“ TODO

```html
<style>
.del { margin-left: 10px; cursor: pointer; }
</style>
<ul class="wrap">
  <li>
    <span class="text">hello</span> <span class="del">x</span>
  </li>
</ul>
<footer>
  <input type="text">
  <button class="add">æ·»åŠ </button>
</footer>
```

å…ˆçœ‹é”™è¯¯ä»£ç ï¼ˆæ–°åˆ›å»ºçš„åˆ é™¤ä¸äº†ï¼Œå› ä¸ºåœ¨æ–°å¢ä¹‹å‰ç»‘å®šäº‹ä»¶å·²ç»å®Œæˆï¼‰

```js
const $ = s => document.querySelector(s)
const createEl = el => document.createElement(el)
const $$ = s => document.querySelectorAll(s)
$('.add').onclick = function() {
  const $text = createEl('span')
  $text.classList.add('text')
  $text.append($('input').value)
  const $del = createEl('span')
  $del.append('x')
  $del.classList.add('del')
  const $li = createEl('li')
  $li.append($text, $del)
  $('.wrap').append($li)
  $('input').value = ''
}
$$('.del').forEach($del => {
  $del.onclick = function() {
    this.parentElement.remove()
  }
})
```

å¦‚æœè¦ç”¨è¿™ç§ï¼Œå°±éœ€è¦åœ¨ `add` ç‚¹å‡»ä¸­æœ«å°¾åŠ å…¥ä»£ç 

```js
$del.onclick = function() {
  this.parentElement.remove()
}
```

æ¯æ¬¡æ·»åŠ çš„æ—¶å€™éƒ½ç»‘å®šäº‹ä»¶ï¼Œä½†æ˜¯ `del` ä»£ç å¾ˆå¤šçš„è¯å¾ˆä¸æ–¹ä¾¿

ä½¿ç”¨**äº‹ä»¶ä»£ç†**å°±æ–¹ä¾¿å¤šäº†

```js
$('.wrap').onclick = function(e) {
  /* åœ¨ wrap ä¸‹çš„éƒ½å¯ä»¥ç‚¹å‡»åˆ°ï¼Œåªåœ¨ç‚¹ del çš„æ—¶å€™åˆ é™¤ */
  if(e.target.classList.contains('del')) {
    e.target.parentElement.remove()
  }
}
```

## é¼ æ ‡äº‹ä»¶

click/dblclick/mouseenter/mouseleave/mouseover/mouseout/mousemove/contentmenu/mouseup/mousedown

### ç‚¹å‡»äº‹ä»¶

- `click` å•å‡»
- `dblclick`  åŒå‡»
- `mousedown`  æŒ‰ä¸‹
- `mouseup`  æ¾å¼€
- `contentmenu`  å³å‡»èœå•

## é”®ç›˜äº‹ä»¶

## çª—å£äº‹ä»¶



### æ»šåŠ¨

## è¡¨å•äº‹ä»¶

## åŠ è½½äº‹ä»¶

1.  é¼ æ ‡äº‹ä»¶ï¼šå½“ç”¨æˆ·é€šè¿‡é¼ æ ‡ä¸é¡µé¢äº¤äº’æ—¶è§¦å‘çš„äº‹ä»¶ï¼Œä¾‹å¦‚ç‚¹å‡»ã€åŒå‡»ã€ç§»åŠ¨ç­‰ã€‚å¸¸è§çš„é¼ æ ‡äº‹ä»¶æœ‰ï¼šclickã€dblclickã€mousedownã€mouseupã€mousemoveã€mouseoverã€mouseoutã€mouseenterã€mouseleave ç­‰ã€‚
    
2.  é”®ç›˜äº‹ä»¶ï¼šå½“ç”¨æˆ·é€šè¿‡é”®ç›˜ä¸é¡µé¢äº¤äº’æ—¶è§¦å‘çš„äº‹ä»¶ï¼Œä¾‹å¦‚æŒ‰ä¸‹ã€å¼¹èµ·ç­‰ã€‚å¸¸è§çš„é”®ç›˜äº‹ä»¶æœ‰ï¼škeydownã€keyupã€keypress ç­‰ã€‚
    
3.  è¡¨å•äº‹ä»¶ï¼šå½“ç”¨æˆ·åœ¨è¡¨å•ä¸­è¿›è¡Œè¾“å…¥æˆ–æäº¤è¡¨å•æ—¶è§¦å‘çš„äº‹ä»¶ã€‚å¸¸è§çš„è¡¨å•äº‹ä»¶æœ‰ï¼šinputã€changeã€submitã€resetã€focusã€blur ç­‰ã€‚
    
4.  æ–‡æ¡£åŠ è½½äº‹ä»¶ï¼šå½“é¡µé¢è¢«åŠ è½½æ—¶è§¦å‘çš„äº‹ä»¶ã€‚å¸¸è§çš„æ–‡æ¡£åŠ è½½äº‹ä»¶æœ‰ï¼šloadã€DOMContentLoaded ç­‰ã€‚
    
5.  çª—å£äº‹ä»¶ï¼šå½“çª—å£å¤§å°æ”¹å˜æˆ–çª—å£è¢«å…³é—­æ—¶è§¦å‘çš„äº‹ä»¶ã€‚å¸¸è§çš„çª—å£äº‹ä»¶æœ‰ï¼šresizeã€scrollã€beforeunloadã€unload ç­‰ã€‚
    
6.  åª’ä½“äº‹ä»¶ï¼šå½“åª’ä½“å…ƒç´ ï¼ˆå¦‚éŸ³é¢‘ã€è§†é¢‘ï¼‰æ’­æ”¾ã€æš‚åœã€ç»“æŸç­‰çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘çš„äº‹ä»¶ã€‚å¸¸è§çš„åª’ä½“äº‹ä»¶æœ‰ï¼šplayã€pauseã€ended ç­‰ã€‚
    
7.  æ‹–æ”¾äº‹ä»¶ï¼šå½“ç”¨æˆ·æ‹–åŠ¨é¡µé¢å…ƒç´ æ—¶è§¦å‘çš„äº‹ä»¶ã€‚å¸¸è§çš„æ‹–æ”¾äº‹ä»¶æœ‰ï¼šdragstartã€dragendã€dragenterã€dragoverã€dragleaveã€drop ç­‰ã€‚
    
8.  åŠ¨ç”»äº‹ä»¶ï¼šå½“ CSS åŠ¨ç”»æˆ–è¿‡æ¸¡å®Œæˆæ—¶è§¦å‘çš„äº‹ä»¶ã€‚å¸¸è§çš„åŠ¨ç”»äº‹ä»¶æœ‰ï¼šanimationstartã€animationendã€animationiterationã€transitionstartã€transitionendã€transitioncancel ç­‰ã€‚